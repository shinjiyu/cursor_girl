# Cursor Agent Hooks

## ğŸ¤– ä»€ä¹ˆæ˜¯ Agent Hooksï¼Ÿ

Agent Hooks å…è®¸ä½ ç›‘æ§å’Œæ§åˆ¶ Cursor AI Agent çš„è¡Œä¸ºï¼Œå½“ Agent æ‰§è¡Œå„ç§æ“ä½œæ—¶è‡ªåŠ¨è§¦å‘ã€‚

## ğŸ“‹ å·²å®ç°çš„ Agent Hooks (9ä¸ª)

| Hookåç§° | ç±»å‹ | è§¦å‘æ—¶æœº | åŠŸèƒ½ |
|---------|------|---------|------|
| `beforeShellExecution` | æƒé™ | Agent æ‰§è¡Œå‘½ä»¤å‰ | å®‰å…¨æ£€æŸ¥ï¼Œæ‹¦æˆªå±é™©å‘½ä»¤ |
| `afterShellExecution` | å®¡è®¡ | Agent æ‰§è¡Œå‘½ä»¤å | å®¡è®¡å‘½ä»¤æ‰§è¡Œç»“æœ |
| `beforeMCPExecution` | æƒé™ | Agent è°ƒç”¨å·¥å…·å‰ | æ£€æŸ¥æ•æ„Ÿå·¥å…· |
| `afterMCPExecution` | å®¡è®¡ | Agent è°ƒç”¨å·¥å…·å | å®¡è®¡å·¥å…·æ‰§è¡Œç»“æœ |
| `afterFileEdit` | å®¡è®¡ | Agent ç¼–è¾‘æ–‡ä»¶å | è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œå®¡è®¡ä¿®æ”¹ |
| `beforeReadFile` | æƒé™ | Agent è¯»å–æ–‡ä»¶å‰ | æ•æ„Ÿæ–‡ä»¶ä¿æŠ¤ |
| `beforeSubmitPrompt` | å®¡è®¡ | Agent æäº¤æç¤ºå‰ | æ£€æµ‹æ•æ„Ÿä¿¡æ¯ |
| `afterAgentResponse` | å®¡è®¡ | Agent å“åº”å | å®¡è®¡ Agent å“åº” |
| `stop` | æ§åˆ¶ | Agent ä»»åŠ¡å®Œæˆ | ä»»åŠ¡å®Œæˆé€šçŸ¥æˆ–ç»§ç»­ |

### âœ¨ æ‰€æœ‰äº‹ä»¶éƒ½è§¦å‘ã‚ªãƒ«ãƒ†ãƒ³ã‚·ã‚¢è¯­éŸ³ï¼

æ¯ä¸ª Hook è¢«è§¦å‘æ—¶ï¼Œã‚ªãƒ«ãƒ†ãƒ³ã‚·ã‚¢ éƒ½ä¼šï¼š
- ğŸ¤ **è¯´è¯** - å®æ—¶è¯­éŸ³åé¦ˆ
- ğŸ­ **åšåŠ¨ä½œ** - æ ¹æ®æƒ…ç»ªæ˜¾ç¤ºè¡¨æƒ…å’ŒåŠ¨ä½œ
- ğŸ“Š **è®°å½•æ—¥å¿—** - è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—

## ğŸš€ éƒ¨ç½² Agent Hooks

### æ–¹æ³• 1: ä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd /path/to/cursorgirl/.cursor-agent
./deploy_agent_hooks.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. å¤åˆ¶æ‰€æœ‰ Hook è„šæœ¬åˆ° `~/.cursor-agent/`
2. è®¾ç½®æ­£ç¡®çš„æ‰§è¡Œæƒé™
3. åˆ›å»º `hooks.json` é…ç½®æ–‡ä»¶
4. åœ¨ `~/.cursor/` åˆ›å»ºç¬¦å·é“¾æ¥
5. å¤åˆ¶åŒ…è£…è„šæœ¬ `run_hook.sh`

### æ–¹æ³• 2: æ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. åˆ›å»ºç›®å½•
mkdir -p ~/.cursor-agent/hooks
mkdir -p ~/.cursor-agent/lib

# 2. å¤åˆ¶æ–‡ä»¶
cp -r hooks/* ~/.cursor-agent/hooks/
cp -r lib/* ~/.cursor-agent/lib/
cp hooks.json ~/.cursor-agent/
cp run_hook.sh ~/.cursor-agent/

# 3. è®¾ç½®æƒé™
chmod +x ~/.cursor-agent/hooks/*.py
chmod +x ~/.cursor-agent/run_hook.sh

# 4. åˆ›å»ºç¬¦å·é“¾æ¥
ln -sf ~/.cursor-agent/hooks.json ~/.cursor/hooks.json

# 5. é‡å¯ Cursor
```

### éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥æ–‡ä»¶
ls -la ~/.cursor-agent/hooks/

# æµ‹è¯• Hook
./test_agent_hooks.sh
```

## ğŸ“Š è¯¦ç»†æ—¥å¿—ç³»ç»Ÿ

æ‰€æœ‰ Agent Hooks ç°åœ¨éƒ½é…å¤‡äº†**è¯¦ç»†çš„å·¥ä½œæ—¥å¿—**ï¼Œè®©ä½ æ¸…æ¥šåœ°çœ‹åˆ°å®ƒä»¬è¢« Cursor è°ƒç”¨æ—¶åšäº†ä»€ä¹ˆã€‚

### ğŸ“ æ—¥å¿—å†…å®¹

æ¯æ¬¡ Hook è¢«è°ƒç”¨æ—¶ï¼Œä¼šè®°å½•ï¼š

1. **è°ƒç”¨ä¿¡æ¯**
   - Hook åç§°
   - æ—¶é—´æˆ³
   - Conversation ID
   - Generation ID
   - Cursor ç‰ˆæœ¬
   - å·¥ä½œåŒºè·¯å¾„

2. **è¾“å…¥æ•°æ®**
   - å®Œæ•´çš„è¾“å…¥å‚æ•°
   - å‘½ä»¤/æ–‡ä»¶/å·¥å…·åç§°
   - å·¥ä½œç›®å½•
   - é™„åŠ ä¸Šä¸‹æ–‡

3. **å¤„ç†è¿‡ç¨‹**
   - æ¯ä¸ªå¤„ç†æ­¥éª¤
   - æ¡ä»¶åˆ¤æ–­
   - æ¨¡å¼åŒ¹é…ç»“æœ
   - å†³ç­–é€»è¾‘

4. **è¾“å‡ºç»“æœ**
   - æƒé™å†³ç­–ï¼ˆallow/deny/askï¼‰
   - ç”¨æˆ·æ¶ˆæ¯
   - Agent æ¶ˆæ¯

5. **ã‚ªãƒ«ãƒ†ãƒ³ã‚·ã‚¢é€šçŸ¥**
   - å‘é€çš„æ–‡æœ¬
   - æƒ…ç»ªç±»å‹
   - WebSocket çŠ¶æ€

6. **æ‰§è¡Œç»Ÿè®¡**
   - æ‰§è¡Œè€—æ—¶
   - æˆåŠŸ/å¤±è´¥çŠ¶æ€

---

## ğŸ” æŸ¥çœ‹æ—¥å¿—

### æ–¹æ³• 1: ä½¿ç”¨æ—¥å¿—æŸ¥çœ‹å·¥å…·ï¼ˆæ¨èï¼‰âœ¨

```bash
cd ~/.cursor-agent
./view_logs.sh
```

åŠŸèƒ½ï¼š
- ğŸ“„ æŸ¥çœ‹æœ€æ–°æ—¥å¿—
- ğŸ“œ æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
- ğŸ‘ï¸ å®æ—¶ç›‘æ§æ—¥å¿—
- ğŸ” æœç´¢æ—¥å¿—
- ğŸ“Š ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°
- â±ï¸ æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡è°ƒç”¨
- ğŸ§¹ æ¸…ç©ºæ—¥å¿—

### æ–¹æ³• 2: ç›´æ¥æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶

```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -f /tmp/cursor-agent-hooks.log

# æŸ¥çœ‹æœ€è¿‘ 50 æ¡
tail -50 /tmp/cursor-agent-hooks.log

# æœç´¢ç‰¹å®š Hook
grep "beforeShellExecution" /tmp/cursor-agent-hooks.log

# æœç´¢é”™è¯¯
grep "ERROR" /tmp/cursor-agent-hooks.log
```

---

## ğŸ“‹ æ—¥å¿—ç¤ºä¾‹

### beforeShellExecution æ—¥å¿—

```
======================================================================
ğŸ“¥ [beforeShellExecution] æ¥æ”¶åˆ° Cursor è°ƒç”¨
======================================================================
ğŸ“‹ è¾“å…¥æ•°æ®æ‘˜è¦:
   â€¢ conversation_id: 43d1d8f4-d658-4aa7-8960-6ac89a31d186
   â€¢ generation_id: c815f15b-ecbf-4355-865e-569d17aa7ba8
   â€¢ command: npm build
   â€¢ cwd: /Users/user/project
   â€¢ hook_event_name: beforeShellExecution
   â€¢ cursor_version: 2.0.43
   â€¢ workspace_roots: ['/Users/user/project']
âœ… è¾“å…¥æ•°æ®è§£ææˆåŠŸ

â³ æ­¥éª¤ 2/3: æ‰§è¡Œ Hook é€»è¾‘...
ğŸ” æ‰§è¡Œæƒé™æ£€æŸ¥...
ğŸ” æ£€æŸ¥å‘½ä»¤: npm build
ğŸ“ å·¥ä½œç›®å½•: /Users/user/project
ğŸ” æ­¥éª¤ 1/3: æ£€æŸ¥å±é™©å‘½ä»¤æ¨¡å¼...
âœ… æœªæ£€æµ‹åˆ°å±é™©å‘½ä»¤
ğŸ” æ­¥éª¤ 2/3: æ£€æŸ¥é£é™©å‘½ä»¤æ¨¡å¼...
âœ… æœªæ£€æµ‹åˆ°é£é™©å‘½ä»¤
ğŸ” æ­¥éª¤ 3/3: æ£€æŸ¥æ˜¯å¦ä¸ºé‡è¦å‘½ä»¤...
ğŸ“¢ æ£€æµ‹åˆ°é‡è¦å‘½ä»¤: npm

ğŸ’¬ å‡†å¤‡å‘é€æ¶ˆæ¯åˆ°ã‚ªãƒ«ãƒ†ãƒ³ã‚·ã‚¢:
   â€¢ æ–‡æœ¬: Agent æ­£åœ¨æ‰§è¡Œï¼šnpm build...
   â€¢ æƒ…ç»ª: neutral
   â€¢ äº‹ä»¶ç±»å‹: beforeShellExecution
   â€¢ WebSocket: ws://localhost:8000/ws
âœ… æ¶ˆæ¯å·²å‘é€åˆ°ã‚ªãƒ«ãƒ†ãƒ³ã‚·ã‚¢

âœ… å…è®¸æ‰§è¡Œå‘½ä»¤
ğŸ” æƒé™å†³ç­–ç»“æœ:
   â€¢ å†³ç­–: allow

ğŸ“¤ è¾“å‡ºå“åº”ç»™ Cursor:
   â€¢ permission: allow

======================================================================
âœ… [beforeShellExecution] Hook æ‰§è¡ŒæˆåŠŸ
â±ï¸  æ‰§è¡Œè€—æ—¶: 0.123 ç§’
======================================================================
```

### beforeShellExecution (å±é™©å‘½ä»¤) æ—¥å¿—

```
======================================================================
ğŸ“¥ [beforeShellExecution] æ¥æ”¶åˆ° Cursor è°ƒç”¨
======================================================================
ğŸ“‹ è¾“å…¥æ•°æ®æ‘˜è¦:
   â€¢ command: rm -rf /
   â€¢ cwd: /Users/user/project
âœ… è¾“å…¥æ•°æ®è§£ææˆåŠŸ

ğŸ” æ‰§è¡Œæƒé™æ£€æŸ¥...
ğŸ” æ£€æŸ¥å‘½ä»¤: rm -rf /
ğŸ” æ­¥éª¤ 1/3: æ£€æŸ¥å±é™©å‘½ä»¤æ¨¡å¼...
ğŸš¨ åŒ¹é…åˆ°å±é™©å‘½ä»¤æ¨¡å¼: rm\s+-rf\s+/
ğŸš« æ‹’ç»æ‰§è¡Œå‘½ä»¤: rm -rf /

ğŸ’¬ å‡†å¤‡å‘é€æ¶ˆæ¯åˆ°ã‚ªãƒ«ãƒ†ãƒ³ã‚·ã‚¢:
   â€¢ æ–‡æœ¬: æ£€æµ‹åˆ°å±é™©å‘½ä»¤ï¼å·²é˜»æ­¢ï¼šrm -rf /
   â€¢ æƒ…ç»ª: angry
   â€¢ WebSocket: ws://localhost:8000/ws
âœ… æ¶ˆæ¯å·²å‘é€åˆ°ã‚ªãƒ«ãƒ†ãƒ³ã‚·ã‚¢

ğŸ” æƒé™å†³ç­–ç»“æœ:
   â€¢ å†³ç­–: deny
   â€¢ ç”¨æˆ·æ¶ˆæ¯: ğŸš« å±é™©å‘½ä»¤å·²è¢«é˜»æ­¢ï¼šrm -rf /

ğŸ“¤ è¾“å‡ºå“åº”ç»™ Cursor:
   â€¢ permission: deny
   â€¢ user_message: ğŸš« å±é™©å‘½ä»¤å·²è¢«é˜»æ­¢ï¼šrm -rf /

======================================================================
âœ… [beforeShellExecution] Hook æ‰§è¡ŒæˆåŠŸ
â±ï¸  æ‰§è¡Œè€—æ—¶: 0.089 ç§’
======================================================================
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. è°ƒè¯• Hook è¡Œä¸º

å½“ä½ åœ¨ Cursor ä¸­çœ‹åˆ° Hook è¢«è°ƒç”¨æ—¶ï¼š

```bash
# æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡è°ƒç”¨çš„è¯¦ç»†ä¿¡æ¯
cd ~/.cursor-agent
./view_logs.sh
# é€‰æ‹© 6 (æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡è°ƒç”¨)
```

ä½ ä¼šçœ‹åˆ°ï¼š
- âœ… Hook æ¥æ”¶åˆ°äº†ä»€ä¹ˆæ•°æ®
- âœ… Hook åšäº†ä»€ä¹ˆå†³ç­–
- âœ… Hook å‘é€äº†ä»€ä¹ˆæ¶ˆæ¯ç»™ã‚ªãƒ«ãƒ†ãƒ³ã‚·ã‚¢
- âœ… Hook è¿”å›äº†ä»€ä¹ˆç»“æœ

### 2. ç›‘æ§å®‰å…¨äº‹ä»¶

```bash
# å®æ—¶ç›‘æ§å±é™©å‘½ä»¤æ‹¦æˆª
tail -f /tmp/cursor-agent-hooks.log | grep -E "å±é™©å‘½ä»¤|é£é™©å‘½ä»¤"
```

### 3. ç»Ÿè®¡ Hook ä½¿ç”¨æƒ…å†µ

```bash
cd ~/.cursor-agent
./view_logs.sh
# é€‰æ‹© 5 (ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°)
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Hook åç§°                      è°ƒç”¨æ¬¡æ•°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
beforeShellExecution            45
afterShellExecution              42
beforeReadFile                   18
afterFileEdit                    12
beforeSubmitPrompt                8
afterAgentResponse                8
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ€»è°ƒç”¨æ¬¡æ•°: 133
æˆåŠŸ: 131
å¤±è´¥: 2
```

### 4. æ’æŸ¥é—®é¢˜

å¦‚æœã‚ªãƒ«ãƒ†ãƒ³ã‚·ã‚¢æ²¡æœ‰å“åº”ï¼š

```bash
# æ£€æŸ¥ Hook æ˜¯å¦è¢«è°ƒç”¨
grep "æ¥æ”¶åˆ° Cursor è°ƒç”¨" /tmp/cursor-agent-hooks.log | tail -5

# æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
grep "ERROR" /tmp/cursor-agent-hooks.log

# æ£€æŸ¥ WebSocket å‘é€
grep "æ¶ˆæ¯å·²å‘é€åˆ°ã‚ªãƒ«ãƒ†ãƒ³ã‚·ã‚¢" /tmp/cursor-agent-hooks.log | tail -5
```

---

## ğŸ”§ æ—¥å¿—çº§åˆ«

æ—¥å¿—åŒ…å«ä¸‰ä¸ªçº§åˆ«ï¼š

- **INFO** (ç»¿è‰²): æ­£å¸¸æµç¨‹ä¿¡æ¯
- **WARNING** (é»„è‰²): è­¦å‘Šä¿¡æ¯ï¼ˆå¦‚æ£€æµ‹åˆ°é£é™©å‘½ä»¤ï¼‰
- **ERROR** (çº¢è‰²): é”™è¯¯ä¿¡æ¯

è¿‡æ»¤ç‰¹å®šçº§åˆ«ï¼š
```bash
grep "INFO" /tmp/cursor-agent-hooks.log    # åªçœ‹ä¿¡æ¯
grep "WARNING" /tmp/cursor-agent-hooks.log # åªçœ‹è­¦å‘Š
grep "ERROR" /tmp/cursor-agent-hooks.log   # åªçœ‹é”™è¯¯
```

---

## ğŸ“Š æ—¥å¿—æ ¼å¼

```
[æ—¶é—´æˆ³] [çº§åˆ«] æ¶ˆæ¯å†…å®¹
```

ç¤ºä¾‹ï¼š
```
[2025-11-02 13:02:07,782] [INFO] ğŸ” æ£€æŸ¥å‘½ä»¤: npm build
```

---

## ğŸ¨ æ—¥å¿—å›¾æ ‡è¯´æ˜

| å›¾æ ‡ | å«ä¹‰ |
|-----|------|
| ğŸ£ | Hook å¯åŠ¨ |
| ğŸ“¥ | æ¥æ”¶è¾“å…¥ |
| ğŸ“‹ | æ•°æ®æ‘˜è¦ |
| â³ | æ‰§è¡Œæ­¥éª¤ |
| ğŸ” | æƒé™æ£€æŸ¥ |
| ğŸ” | æ¡ä»¶åˆ¤æ–­ |
| âœ… | æˆåŠŸ/é€šè¿‡ |
| âš ï¸ | è­¦å‘Š |
| ğŸš¨ | å±é™© |
| ğŸš« | æ‹’ç» |
| â“ | éœ€è¦ç¡®è®¤ |
| ğŸ’¬ | å‘é€æ¶ˆæ¯ |
| ğŸ“¤ | è¾“å‡ºå“åº” |
| â±ï¸ | æ‰§è¡Œè€—æ—¶ |
| âŒ | å¤±è´¥/é”™è¯¯ |
| ğŸ“¢ | é‡è¦é€šçŸ¥ |
| â„¹ï¸ | ä¸€èˆ¬ä¿¡æ¯ |

---

## ğŸ› ï¸ è‡ªå®šä¹‰æ—¥å¿—

å¦‚æœä½ æƒ³ä¿®æ”¹æ—¥å¿—æ ¼å¼æˆ–æ·»åŠ æ›´å¤šæ—¥å¿—ï¼Œç¼–è¾‘ï¼š

```
~/.cursor-agent/lib/agent_hook_handler.py
```

å…³é”®æ–¹æ³•ï¼š
- `read_input()` - è¾“å…¥æ—¥å¿—
- `write_output()` - è¾“å‡ºæ—¥å¿—
- `send_to_ortensia()` - WebSocket æ—¥å¿—
- `run()` - æ‰§è¡Œæµç¨‹æ—¥å¿—

---

## ğŸ“š ç›¸å…³å‘½ä»¤

```bash
# æŸ¥çœ‹æ—¥å¿—
tail -f /tmp/cursor-agent-hooks.log

# ä½¿ç”¨æ—¥å¿—å·¥å…·
cd ~/.cursor-agent && ./view_logs.sh

# æµ‹è¯• Hook
echo '{"command":"ls"}' | python3 ~/.cursor-agent/hooks/beforeShellExecution.py

# æ¸…ç©ºæ—¥å¿—
> /tmp/cursor-agent-hooks.log

# ç»Ÿè®¡æ—¥å¿—è¡Œæ•°
wc -l /tmp/cursor-agent-hooks.log

# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶å¤§å°
ls -lh /tmp/cursor-agent-hooks.log
```

---

**æ—¥å¿—æ–‡ä»¶ä½ç½®**: `/tmp/cursor-agent-hooks.log`  
**æ—¥å¿—æŸ¥çœ‹å·¥å…·**: `~/.cursor-agent/view_logs.sh`  
**ç‰ˆæœ¬**: 2.1.0 (with detailed logging)

