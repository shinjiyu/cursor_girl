# Vibe Coding 文档规范

> **AI 友好的项目文档管理标准**
> 
> 设计目标：让 AI 能快速理解项目、定位代码、避免重复踩坑

---

## 🎯 核心理念

### 1. 协议是灵魂

**原则**：协议文档是项目的核心，定义了系统的通信规范和数据结构

**为什么重要**：
- AI 需要理解系统组件如何通信
- 协议变更影响多个模块
- 协议是代码实现的依据

**实践**：
```
docs/
├── protocols/              # 协议文档目录
│   ├── PROTOCOL.md        # 主协议文档
│   └── MESSAGE_TYPES.md   # 消息类型参考
```

### 2. 代码地图优于描述

**原则**：告诉 AI "代码在哪"，而不是"代码做什么"

**对比**：
```
❌ 糟糕的文档：
"系统使用 WebSocket 进行通信，客户端连接后会发送注册消息..."

✅ 好的文档：
| 功能 | 文件 | 函数 |
|-----|------|-----|
| WebSocket 连接 | `client.ts:100` | `connect()` |
| 注册消息发送 | `client.ts:150` | `sendRegister()` |
```

### 3. 陷阱清单是金

**原则**：记录踩过的坑，防止 AI 重复犯错

**格式**：
```
| 陷阱 | 表现 | 解决方案 | 代码位置 |
|-----|------|---------|---------|
| 描述 | 错误日志/现象 | 如何修复 | 具体行号 |
```

### 4. 不要记录变更

**原则**：Git 已经记录了变更历史，不需要在文档中重复

**例外**：重大架构决策可以用 ADR（Architecture Decision Record）记录

---

## 📂 推荐目录结构

```
docs/
├── AI_INDEX.md             # 🤖 AI 入口（必须）
│
├── protocols/              # 📜 协议文档（最重要）
│   ├── README.md          # 协议概述
│   └── *.md               # 各类协议
│
├── _FEATURES/              # 📦 功能实现记录
│   ├── _TEMPLATE.md       # 功能文档模板
│   └── *.md               # 各功能实现
│
├── _DECISIONS/             # 🎯 架构决策记录 (ADR)
│   └── ADR-*.md           # 重大决策
│
└── guides/                 # 📖 使用指南（给人看的）
    └── *.md
```

---

## 📄 AI_INDEX.md 模板

```markdown
# 🤖 AI 协作索引

## 📜 协议优先

| 协议 | 文档 | 说明 |
|-----|------|------|
| 主协议 | `path/to/protocol.md` | 核心通信规范 |

## 🗺️ 代码地图

| 职责 | 文件 | 关键函数 |
|-----|------|---------|
| 功能A | `path/to/file.ts` | `functionName()` |

## 🔑 核心设计原则

### 1. 原则名称
**原则**：一句话描述
**示例**：代码示例

## ⚠️ 已知陷阱

| 陷阱 | 表现 | 解决方案 | 代码位置 |
|-----|------|---------|---------|
| 描述 | 日志/现象 | 修复方法 | 文件:行号 |

## 📂 功能实现索引

| 功能 | 实现文档 | 核心代码 |
|-----|---------|---------|
| 功能名 | `_FEATURES/xxx.md` | `函数名()` |

## 🔍 快速定位

### 按问题找代码
| 问题 | 相关代码 |
|-----|---------|
| xxx 失败 | `file.ts:functionName()` |

### 按消息/API 找代码
| API/消息 | 处理代码 |
|---------|---------|
| `GET /xxx` | `controller.ts:handler()` |
```

---

## 📄 功能文档模板 (_FEATURES/_TEMPLATE.md)

```markdown
# 功能：[名称]

> 一句话描述

## 📍 代码位置

| 组件 | 文件 | 行号 | 函数 |
|-----|------|-----|------|
| 前端 | `path/file.ts` | 100-200 | `func()` |
| 后端 | `path/file.py` | 50-80 | `handler()` |

## 🔄 流程

```
组件A → 消息类型 → 组件B
          ↓
        处理逻辑
          ↓
组件A ← 响应消息 ← 组件B
```

## 💡 关键实现

### 1. 要点名称
**为什么**：原因
**代码**：位置

## ⚠️ 陷阱

| 问题 | 解决 |
|-----|------|
| xxx | yyy |
```

---

## 📄 ADR 模板 (_DECISIONS/ADR-XXX.md)

```markdown
# ADR-XXX: 决策标题

> 状态: 已采纳 | 日期: YYYY-MM-DD

## 背景
为什么需要做这个决策

## 决策
采用什么方案

## 替代方案
考虑过哪些其他方案，为什么没选

## 后果
正面影响和负面影响

## 相关代码
- `path/to/file.ts`
```

---

## ✅ 最佳实践

### 1. 保持简洁

```
❌ 不要写长篇大论
✅ 用表格、列表、代码块
```

### 2. 代码位置要精确

```
❌ "在 utils 目录下"
✅ "src/utils/client.ts:150-200"
```

### 3. 协议文档要同步

```
❌ 协议定义和文档分离
✅ 协议定义文件本身就是文档（良好的注释）
```

### 4. 陷阱要包含解决方案

```
❌ "这里有个 bug"
✅ "问题：xxx | 解决：yyy | 位置：zzz"
```

### 5. 入口要单一

```
❌ 多个索引文件互相引用
✅ 一个 AI_INDEX.md 作为唯一入口
```

---

## 🤖 AI 使用流程

```
收到任务
    │
    ▼
阅读 AI_INDEX.md
    │
    ├─ 涉及通信？ → 阅读协议文档
    │
    ├─ 需要代码？ → 查看代码地图
    │
    ├─ 有陷阱？   → 查看已知陷阱
    │
    └─ 新功能？   → 查看类似功能实现
    │
    ▼
执行任务
    │
    ▼
更新 AI_INDEX.md（如有必要）
```

---

## 📊 文档健康检查

定期检查：

- [ ] AI_INDEX.md 的代码位置是否准确
- [ ] 协议文档是否与代码同步
- [ ] 陷阱清单是否更新
- [ ] 功能文档是否覆盖主要功能

---

**版本**: 1.0  
**适用于**: 任何需要 AI 协作的项目

